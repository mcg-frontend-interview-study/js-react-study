# 가상 DOM과 React Fiber

## 1. 가상 DOM이란?

### 배경

- 브라우저에서 DOM 조작은 비용이 크고, 사용자의 인터렉션으로 DOM이 빈번히 변경되면 비효율적입니다.

### 가상 DOM

- 메모리 상에 DOM의 구조를 객체 형태로 저장하고, 변경 사항을 비교하여 필요한 부분만 실제 DOM에 반영합니다.
- 렌더링 과정을 최소화하고 성능을 개선합니다.

---

## 2. React Fiber란

### 정의

- React 16부터 도입된 **React의 가상 DOM 관리 객체 및 알고리즘**입니다.

### 역할

- **파이버 재조정자(fiber reconciler)**는 가상 DOM과 실제 DOM을 비교하여 변경 사항을 추적합니다. 이 과정에서 가상 DOM과 실제 DOM 사이에 차이가 발생하면, 해당 차이에 대한 정보를 포함하는 파이버를 기준으로 화면 렌더링을 요청합니다.

### Fiber의 렌더링 과정

1. **렌더 단계** (비동기): 변경 사항을 계산하며, 작업을 중단하거나 우선순위에 따라 처리합니다.
2. **커밋 단계** (동기): 실제 DOM에 변경 사항을 반영합니다.

---

## 3. Fiber는 어떻게 구현되어 있는가?

### Fiber Node

- React 컴포넌트에 대한 정보를 저장하는 객체입니다.

- 주요 속성:
  - `tag`: 컴포넌트 타입입니다.
  - `stateNode`: 컴포넌트 상태 참조입니다.
  - `child`, `sibling`, `return`: 트리 구조 관계를 나타냅니다.
  - `index`: 형제 노드 간 순서입니다.

### 생성 및 재사용

- 컴포넌트가 처음 마운트될 때 생성되며, 가능한 한 재사용됩니다.

---

## 4. Fiber Tree란?

### 트리 구조

- React 애플리케이션은 **현재 트리(Current Tree)**와 **작업 중 트리(Work-In-Progress Tree)**를 동시에 관리합니다.

### 작업 흐름

1. `beginWork`로 Fiber 작업을 시작합니다.
2. 자식 노드까지 작업 완료 후, `completeWork`로 처리합니다.
3. 모든 작업이 끝나면 변경 사항을 DOM에 반영합니다.
4. 작업이 끝난 트리를 현재 트리로 전환합니다.

### 예시 트리 작업

```jsx
<A1>
  <B1>hello</B1>
  <B2>
    <C1>
      <D1 />
      <D2 />
    </C1>
  </B2>
  <B3 />
</A1>
```

### 상태가 변화할 때

setState 호출로 상태가 변화하면 기존 트리를 기반으로 새로운 Work-In-Progress 트리가 생성되고, 업데이트된 props로 처리됩니다.

---

## 5. Fiber와 가상 DOM의 관계

리액트 컴포넌트에 대한 정보를 1:1로 갖고 있는 것이 파이버이며, 파이버는 리액트 아키텍처 내부에서 비동기로 이루어집니다. 반면, 실제 브라우저 구조인 DOM에 반영하는 것은 동기적으로 일어나야 하며, 처리하는 작업이 많아 불완전하게 표시될 수 있는 가능성이 높습니다. 따라서 이 작업을 메모리 상에서 먼저 수행하여 최종적인 결과물만 실제 DOM에 적용합니다.
